<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="css/loginbundle.css">
    <title>PSAP Logout Page</title>
    <STYLE TYPE="text/css">
		
		.hidden {
			font-weight:bold;
			position:absolute;
			left:-10000px;
			top:auto;
			width:1px;
			height:1px;
			overflow:hidden;
		}
		
		.visible {
			font-weight:bold;
			position:static; 
			width:auto; 
			height:auto;
		}
		</STYLE>
		
    <SCRIPT type="text/javascript">
            
    	function setInputBox(){
    		var mql = window.matchMedia("screen and (max-width: 768px)")
    		
    		//var mql = "screen and (max-device-width: 480px)";
    		console.log("mql - "+mql);
    		if (mql.matches){ // if media query matches
    	  		console.log("Mobile detected.")
    			document.getElementById("desktop").removeAttribute("name");
                return "mobile";
    	 	}
    	 	else{
    	  		console.log("Desktop detected");
    	  		document.getElementById("mobile").removeAttribute("name"); 
    	  		return "desktop";
    	 	}
    	}

        function windowStart() {
           setInputBox();
        }
            
       	
       	var animationStep = 0;
		var nextlocation = "http://172.27.50.135:9080/PSAP";
		var redirectTimeout = 3;
		var endTimeout;
		var animationInterval;
		var timeoutInterval;
		var iFramesLoaded;

		function loadscript()
		{
			var i;
			iFramesLoaded = new Array(6);
			for(i=0;i<6;i++) {
			  iFramesLoaded[i] = false;
			}
			endTimeout = setTimeout(doEndAnimation, 2000); // waiting at maxiumum 10 seconds
			setTimeout(doAnimationAndCheck, 100); // quick update of the message
			animationInterval = setInterval(doAnimationAndCheck, 750);
		}
		function doEndAnimation()
		{
			console.log("end animation");

			animationStep = 5;

			clearInterval(animationInterval);

			var logoutMessageField = document.querySelector('#logoutmessage');
			logoutMessageField.innerHTML = "You are now logged out.";
			setGreeting();

			var logoutHidden_1 = document.querySelector('#hidden_1');
			if (logoutHidden_1!=null) {
				logoutHidden_1.style.visibility = 'visible';
			}

			var logoutHidden_2 = document.querySelector('#hidden_2');
			if (logoutHidden_2!=null) {
				logoutHidden_2.style.visibility = 'visible';
			}

			var logoutHidden_3 = document.querySelector('#hidden_3');
			if (logoutHidden_3!=null) {
				logoutHidden_3.style.visibility = 'visible';
			}

			updateTimeoutField();
			timeoutInterval = setInterval(updateTimeoutField, 1000);
		}
		function updateTimeoutField()
		{
			if (redirectTimeout==0) {
				window.location = nextlocation;
				clearInterval(timeoutInterval);
			}
			var msg = "You'll be redirected back to PSAP in {0} seconds".replace("{0}", redirectTimeout);
			var countDownField = document.querySelector('#countdown');
			countDownField.innerHTML = msg;
			if (redirectTimeout>0) {
				redirectTimeout--;
			}
		}
		function loadedIFrame(iFrameNumber)
		{
			iFramesLoaded[iFrameNumber] = true;
			console.log("Loaded iframe: " + iFrameNumber);
		}
		function doAnimationAndCheck()
		{
		  var result = "You are being logged out...";

		  if (animationStep<4) {

			  var char1 = result.substring(result.length-3, result.length-2);
			  var char2 = result.substring(result.length-2, result.length-1);
			  var char3 = result.substring(result.length-1, result.length);

			  var light  = '#ffffff';
			  var medium = '#aaaaaa';

			  var base = result.substring(0, result.length-3);

			  if (animationStep==0) { // 0: <light>.<medium>.<medium>
				  result = base + '<span style=\"color:' + light + '\">' + char1 + '</span><span style=\"color:' + medium + '\">' + char2 + '</span><span style=\"color:' + medium +  '\">' + char3 + '</span>';
				  animationStep = 1;
			  } else if (animationStep==1) { // 1: <medium>.<light>.<medium>
				  result = base + '<span style=\"color:' + medium + '\">' + char1 + '</span><span style=\"color:' + light + '\">' + char2 + '</span><span style=\"color:' + medium +  '\">' + char3 + '</span>';
				  animationStep = 2;
			  } else if (animationStep==2) { // 2: <medium>.<medium>.<light>
				  result = base + '<span style=\"color:' + medium + '\">' + char1 + '</span><span style=\"color:' + medium + '\">' + char2 + '</span><span style=\"color:' + light +  '\">' + char3 +'</span>';
				  animationStep = 0;
			  }

			  // 3: no animation any more
			  var logoutMessageField = document.querySelector('#logoutmessage');
			  if (logoutMessageField!=null) {
				  logoutMessageField.innerHTML = result;
			  }
		  }
		  
		  if (allIframesLoaded()) {
			clearTimeout(endTimeout);
			doEndAnimation();
		  }
		}
		function allIframesLoaded() 
		{
		  var i;
		  for(i=0; i<6; i++) {
			if (iFramesLoaded[i]==false) {
				return false;
			}
		  }
		  console.log("allFramesLoaded");
		  return true;
		}
		function setGreeting() 
		{
		  var greetingField = document.querySelector('#hidden_1');
		  var morningGreeting = "Have a great morning";
		  var dayGreeting     = "Have a great day";
		  var eveningGreeting = "Have a great evening";
		  var greeting;
		  var now = new Date();
		  var hoursOfNow = now.getHours();
		  if (hoursOfNow < 2) {
			greeting = eveningGreeting;
		  } else if (hoursOfNow < 10) {
			greeting = morningGreeting;
		  } else if (hoursOfNow < 18) {
			greeting = dayGreeting;
		  } else {
			greeting = eveningGreeting;
		  }
		  greetingField.innerHTML = greeting;
		}
		loadscript();		     
        window.onload = windowStart;
            
    </SCRIPT>
  </head>
	<body>
  		<div class="wrapper">
	    	<!-- header -->
	      	<div id="header">
	        	<div class="inner">
	            	<div id="logo"></div>
	          	</div>
	      	</div>
	      	<!-- /header -->
	      
			<div class="inner">
	  			<div class="container">
	    		<div align="center" id="logoutMsg">
			       <div style="display: table-row; width: 100%;">
			         <div style="display: table-cell; vertical-align: middle; text-align: center; color: black;" id="logoutmessage">
			           You are being logged out...
			         </div>
			       </div>
			       <div style="display: table-row; width: 100%;">
			         <div style="height: 35px; width: 100%;"></div>
			       </div>
			       <div style="display: table-row; width: 100%;">
			         <div style="display: table-cell; vertical-align: middle; text-align: center; font-size: 22px; color: #black; visibility: hidden;" id="hidden_1">
			           Have a great day
			         </div>
			       </div>
			       <div style="display: table-row; width: 100%;">
         			 <div style="height: 35px; width: 100%;"></div>
       				</div>
			       <div style="display: table-row; width: 100%;">
			         <div style="display: table-cell; vertical-align: middle; text-align: center; font-size: 12px; color: #black; visibility: hidden;" id="hidden_2">
			           <div id="countdown">You'll be redirected back to PSAP in {0} seconds</div>
			         </div>
			       </div>
			       <div style="display: table-row; width: 100%;">
         				<div style="height: 35px; width: 100%;"></div>
       				</div>
			       <div style="display: table-row; width: 100%;">
			         <div style="display: table-cell; vertical-align: middle; text-align: center; font-size: 12px; color: #black; visibility: hidden;" id="hidden_3">
			           <a href="http://172.27.50.135:9080/PSAP">Return to the home page</a> or <a href="http://172.27.50.135:9080/PSAP">Log back in to PSAP</a>
			         </div>
			       </div>
				    				
	      			</div>
				</div>
			</div>
    	</div>
    	<!-- footer -->
    	<div id="footer">
      		<div class="inner">
        		<div id="logo"></div>
      		</div>
    	</div>
    	<!-- /footer -->
  	</body>
</html>